name: Extract Facebook Metadata

on:
  workflow_dispatch:  # Chạy thủ công từ GitHub UI
  schedule:
    - cron: '0 0 * * *'  # Chạy hàng ngày

jobs:
  extract_metadata:
    runs-on: ubuntu-latest

    steps:
      - name: Check out the repository
        uses: actions/checkout@v2

      - name: Set up dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y curl jq

      - name: Extract metadata from Facebook
        run: |
          # Define the URLs to extract data from
          urls=("https://www.facebook.com/story.php?story_fbid=122107539026822761&id=61574682854737" 
                "https://www.facebook.com/story.php?story_fbid=122201033888166001&id=61554980033586")

          # Function to extract HTML content
          extract_metadata_from_url() {
            local url=$1
            response=$(curl -s "$url")

            # Extract title, description, image URL
            title=$(echo "$response" | grep -oP '(?<=<meta property="og:title" content=").*?(?=")' || echo "No title")
            description=$(echo "$response" | grep -oP '(?<=<meta property="og:description" content=").*?(?=")' || echo "No description")
            image=$(echo "$response" | grep -oP '(?<=<meta property="og:image" content=").*?(?=")' || echo "No image")

            # Output JSON
            echo "{\"url\":\"$url\",\"title\":\"$title\",\"description\":\"$description\",\"image\":\"$image\",\"status\":\"success\",\"post_type\":\"story\"}"
          }

          # Loop through each URL and extract metadata
          for url in "${urls[@]}"; do
            extract_metadata_from_url "$url" >> metadata.json
          done

      - name: Upload metadata to Gist
        uses: actions/upload-artifact@v3
        with:
          name: metadata
          path: metadata.json
